# frozen_string_literal: true

require "rails_helper"

RSpec.describe RemoveMalwareBlob do
  describe "#call" do
    let(:result) { "suspect" }
    let(:upload) { create(:upload, malware_scan_result: result) }
    subject(:remove_malware_blob) { described_class.call(upload:) }

    it "removes the upload attachment" do
      remove_malware_blob

      expect(upload.reload.attachment.filename).to be_nil
      expect(upload.reload.attachment.download).to be_nil
    end

    context "when the upload does not have a suspect scan result" do
      let(:result) { "clean" }

      it "does not remove the malware blob" do
        remove_malware_blob

        expect(upload.reload.attachment.filename).to be_present
        expect(upload.reload.attachment.download).to be_present
      end
    end
  end
end
