<% content_for :page_title, "Apply for qualified teacher status (QTS)" %>

<h1 class="govuk-heading-xl">Apply for qualified teacher status (QTS)</h1>

<% if @view_object.application_form.draft? %>
  <h2 class="govuk-heading-s govuk-!-margin-bottom-2">
    <% if @view_object.can_submit? %>
      Application complete
    <% else %>
      Application incomplete
    <% end %>
  </h2>

  <p class="govuk-body govuk-!-margin-bottom-7">
    You have completed <%= @view_object.completed_task_sections.count %> of <%= @view_object.tasks.count %> sections.
  </p>

  <% if @view_object.application_form.created_under_new_regulations? %>
    <%= govuk_inset_text do %>
      <p class="govuk-body">
        You started this application on <%= @view_object.started_at %>.
        Applications must be completed within 6 months, so you’ll need to complete it before <%= @view_object.expires_at %>.
      </p>
    <% end %>
  <% end %>

  <ol class="app-task-list">
    <% @view_object.tasks.each_with_index do |(section, items), index| %>
      <li>
        <h2 class="app-task-list__section">
          <span class="app-task-list__section-number"><%= index + 1 %>. </span>
          <%= I18n.t("application_form.tasks.sections.#{section}") %>
        </h2>

        <ul class="app-task-list__items">
          <% items.each do |item| %>
            <li class="app-task-list__item">
              <span class="app-task-list__task-name">
                <%= link_to @view_object.text_for_task_item(item),
                            @view_object.path_for_task_item(item),
                            aria: { describedby: "#{item}-status" } %>
              </span>

              <%= render(StatusTag::Component.new(
                key: item,
                status: @view_object.task_statuses.dig(section, item),
                class_context: "app-task-list"
              )) %>
            </li>
          <% end %>
        </ul>
      </li>
    <% end %>
  </ol>

  <div class="govuk-button-group">
    <%- if @view_object.can_submit? -%>
      <%= govuk_button_link_to "Check your answers", edit_teacher_interface_application_form_path %>
    <%- end -%>
    <%= govuk_button_link_to "Save and sign out", destroy_teacher_session_path, secondary: true %>
  </div>
<% elsif @view_object.application_form.declined? %>
  <h2 class="govuk-heading-l">Your QTS application has been declined</h2>
 
  <%- if @view_object.show_further_information_request_expired_content? -%>
    <%= govuk_inset_text(text:t(".further_information_request_expired")) %>
  <%- end -%>

  <% if (sections = @view_object.notes_from_assessors).present? %>
    <h3 class="govuk-heading-m">Notes from the assessor:</h3>

    <% sections.each do |section| %>
      <h4 class="govuk-heading-s"><%= t(".assessment_section.#{section[:assessment_section_key]}") %></h4>
      <ul class="govuk-list">
        <% section[:failure_reasons].each do |failure_reason| %>
          <li>
            <h5 class="govuk-body">
              <%= t("assessor_interface.assessment_sections.show.failure_reasons.#{failure_reason[:key]}") %>
            </h5>

            <% if (text = failure_reason[:assessor_feedback]).present? %>
              <%= govuk_inset_text { simple_format text } %>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>
  <% end %>
  <% if @view_object.assessment.recommendation_assessor_note.present? %>
    <h3 class="govuk-heading-m">Why your application was declined</h3>
    <p class="govuk-body">
     <%= @view_object.assessment.recommendation_assessor_note %>
    </p>
  <% end %>
  
  <h3 class="govuk-heading-m">What you can do next</h3>

  <% unless @view_object.declined_cannot_reapply? %>
    <p class="govuk-body">While your QTS application was declined this time, you can make a new application in future, if you’re able to address the decline reasons we’ve set out.</p>

    <p class="govuk-body">If you reapply for QTS, you will not be able to review the details of your previous application.</p>

    <p class="govuk-body">
      <%= govuk_button_link_to "Apply again", new_teacher_interface_application_form_path %>
    </p>

    <p class="govuk-body">You may want to explore other routes to teaching in England. QTS is not a requirement to teach in independent (private) schools, academies, free schools and in the further education (FE) sector in England.</p>

    <p class="govuk-body">You can find out more about working in these sectors from:</p>

    <ul class="govuk-list">
      <li><%= govuk_link_to "Independent Schools Council", "http://www.isc.co.uk/" %></li>
      <li><%= govuk_link_to "The Education & Training Foundation", "http://www.et-foundation.co.uk/" %></li>
      <li><%= govuk_link_to "Academies and Free Schools", "https://www.gov.uk/types-of-school" %></li>
    </ul>

    <p class="govuk-body">For further information on other routes to gaining QTS visit <a href="https://getintoteaching.education.gov.uk/non-uk-teachers/teach-in-england-if-you-trained-overseas" class="govuk-link">Get into teaching</a>.</p>
    <p class="govuk-body">You can also learn more about <a href="https://getintoteaching.education.gov.uk/non-uk-teachers/train-to-teach-in-england-as-an-international-student" class="govuk-link">training to teach in England</a>.</p>

    <p class="govuk-body">You have the right of appeal to the Head of Teacher Qualifications and/or the County Court against this decision.</p>
  <% end %>

  <p class="govuk-body">If you want to appeal, you should contact <%= govuk_link_to t("service.email.enquiries"), "mailto:#{t("service.email.enquiries")}" %> and do so within 4 months of this notification.</p>
<% elsif @view_object.application_form.awarded? %>
  <h2 class="govuk-heading-l">Your QTS application was successful</h2>

  <p class="govuk-body">As someone with qualified teacher status, you’ve been assigned a teacher reference number (TRN).</p>

  <p class="govuk-body">Your TRN is:</p>
  <%= govuk_inset_text(text: @view_object.teacher.trn) %>

  <h3 class="govuk-heading-m">Next steps</h3>

  <p class="govuk-body">To download a PDF of your QTS certificate and find your date of recognition, visit:</p>
  <p class="govuk-body"><%= govuk_link_to "https://www.gov.uk/guidance/teacher-self-service-portal", "https://www.gov.uk/guidance/teacher-self-service-portal" %></p>

  <h3 class="govuk-heading-m">Find out more about teaching in England</h3>

  <p class="govuk-body">There’s more information about coming to teach in England, including details about visas and immigration, in the <a href="https://www.gov.uk/government/publications/teach-in-england-if-you-qualified-outside-the-uk/teach-in-england-if-you-qualified-outside-the-uk" class="govuk-link">Department for Education’s guidance for teachers who qualified outside the UK</a>.</p>

  <h3 class="govuk-heading-m">Search for a job in teaching</h3>

  <p class="govuk-body">You can search for a teaching job using <a href="https://teaching-vacancies.service.gov.uk" class="govuk-link">Teaching Vacancies</a>. It’s the official government service that schools use to list their teaching roles. You can also sign up to alerts for the latest jobs matching your key search criteria.</p>

  <h3 class="govuk-heading-m">Get support with your application</h3>

  <p class="govuk-body">If you’re applying for a secondary school maths, physics or modern foreign languages teaching role in England, use the Get into Teaching service for one-to-one support with your application through <a href="https://adviser-getintoteaching.education.gov.uk" class="govuk-link">Get an advisor</a>.</p>
  <p class="govuk-body">Your adviser can help with writing a personal statement, preparing for an interview and accessing courses to enhance your subject knowledge.</p>
<% elsif @view_object.further_information_request&.requested? %>
  <h2 class="govuk-heading-m">We need some more information</h2>
  <p class="govuk-body">The assessor needs you to provide some additional information so they can continue reviewing your application.</p>
  <div class="govuk-inset-text">
    You may need to upload 1 or more documents. Make sure any files you upload clearly show the whole document or page, and that any text is easy to read.
  </div>
  <p class="govuk-body">You must add all of the requested information, so the assessor can continue reviewing your QTS application.</p>
  <p class="govuk-body">The next screen will take you to the first section you need to complete.</p>
  <%= govuk_start_button(text: "Start now", href: teacher_interface_application_form_further_information_request_path(@view_object.further_information_request)) %>
<% else %>
  <%= govuk_panel(title_text: @view_object.further_information_request&.received? ? "Further information successfully submitted" : "Application complete") do %>
    Your reference number
    <br />
    <strong><%= @view_object.application_form.reference %></strong>
  <% end %>

  <% if @view_object.further_information_request&.received? %>
    <h3 class="govuk-heading-m">You’ve successfully submitted your further information</h3>
    <p class="govuk-body">We’ve sent you an email to confirm that we’ve received it.</p>
    <p class="govuk-body">Once the assessor has checked the documents to make sure you’ve provided all of the requested information, they’ll continue reviewing your QTS application.</p>
    <p class="govuk-body">You can now close this page.</p>
  <% else %>
    <p class="govuk-body">We’ve received your application for QTS and we’ve sent you a confirmation email.</p>
    <p class="govuk-body">Keep the email safe, as you may need your reference number for future correspondence about your application.</p>

    <h2 class="govuk-heading-m">What happens next</h2>
    <p class="govuk-body">We aim to review your application within 1 month. If we need more information, we’ll email you again.</p>
    <p class="govuk-body">We aim to reach a final decision on QTS applications within 80 working days (4 months) of submission.</p>
  <% end %>

  <h2 class="govuk-heading-s">Help us to improve this service</h2>

  <p class="govuk-body">
    Please <a href="https://docs.google.com/forms/d/e/1FAIpQLSePiIC7xO1Dt6oxvIdL6jcGrlUkRDJDS1kxOcqvK-uspBED9w/viewform" class="govuk-link">give us feedback</a> about your experience of using this service. It should take less than 2 minutes to complete.
  </p>

  <p class="govuk-body">
    We’re always trying to improve this service and boost teacher recruitment from overseas. So we’d like to talk to people about their experience of using this service.
  </p>

  <p class="govuk-body">
    If you'd like to help, please <a href="https://docs.google.com/forms/d/e/1FAIpQLSdH_nfDnt9OUolI25fLs27uitWWn63KibNWsGFOYT-Os14PRg/viewform" class="govuk-link">complete this form</a>.
  </p>

  <p class="govuk-body">If you match our search criteria, we'll invite you to take part in research.</p>

  <h2 class="govuk-heading-s">If you have any questions, contact:</h2>
  <p class="govuk-body"><%= govuk_link_to t("service.email.enquiries"), "mailto:#{t("service.email.enquiries")}" %></p>
<% end %>
