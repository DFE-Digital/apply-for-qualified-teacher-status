<% content_for :page_title, "Apply for qualified teacher status (QTS)" %>

<h1 class="govuk-heading-xl">Apply for qualified teacher status (QTS)</h1>

<% if @application_form.submitted? %>
  <%= govuk_panel(title_text: "Application complete") do %>
    Your reference number
    <br />
    <strong><%= @application_form.reference %></strong>
  <% end %>
<% else %>
  <h2 class="govuk-heading-s govuk-!-margin-bottom-2">
    <% if @application_form.can_submit? %>
      Application complete
    <% else %>
      Application incomplete
    <% end %>
  </h2>

  <p class="govuk-body govuk-!-margin-bottom-7">
    You have completed <%= @application_form.completed_task_sections.count %> of <%= @application_form.tasks.count %> sections.
  </p>

  <ol class="app-task-list">
    <% @application_form.tasks.each_with_index do |(section, items), index| %>
      <li>
        <h2 class="app-task-list__section">
          <span class="app-task-list__section-number"><%= index + 1 %>. </span>
          <%= I18n.t("application_form.tasks.sections.#{section}") %>
        </h2>

        <ul class="app-task-list__items">
          <% items.each do |item| %>
            <li class="app-task-list__item">
              <span class="app-task-list__task-name">
                <%= link_to I18n.t("application_form.tasks.items.#{item}"),
                            @application_form.path_for_task_item(item),
                            aria: { describedby: "#{item}-status" } %>
              </span>

              <%= render(ApplicationFormStatusTag::Component.new(
                key: item,
                status: @application_form.task_statuses.dig(section, item),
                class_context: "app-task-list"
              )) %>
            </li>
          <% end %>
        </ul>
      </li>
    <% end %>
  </ol>

  <div class="govuk-button-group">
    <%= govuk_button_link_to "Check your answers", edit_teacher_interface_application_form_path %>
    <%= govuk_button_link_to "Save and sign out", destroy_teacher_session_path, secondary: true %>
  </div>
<% end %>
