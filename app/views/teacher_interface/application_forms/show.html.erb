<% content_for :page_title, "Apply for qualified teacher status (QTS)" %>

<h1 class="govuk-heading-xl">Apply for qualified teacher status (QTS)</h1>

<% if @application_form.submitted? %>
  <%= govuk_panel(title_text: "Application complete") do %>
    Your reference number
    <br />
    <strong><%= @application_form.reference %></strong>
  <% end %>
<% else %>
  <h2 class="govuk-heading-s govuk-!-margin-bottom-2">
    <% if @application_form.can_submit? %>
      Application complete
    <% else %>
      Application incomplete
    <% end %>
  </h2>

  <p class="govuk-body govuk-!-margin-bottom-7">
    You have completed <%= @application_form.completed_sections.count %> of <%= ApplicationForm::SECTIONS.count %> sections.
  </p>

  <ol class="app-task-list">
    <% ApplicationForm::SECTIONS.each_with_index do |(section_key, subsection_keys), index| %>
      <li>
        <h2 class="app-task-list__section">
          <span class="app-task-list__section-number"><%= index + 1 %>. </span> <%= section_key.to_s.humanize %>
        </h2>

        <ul class="app-task-list__items">
          <% subsection_keys.each do |subsection_key| %>
            <li class="app-task-list__item">
              <span class="app-task-list__task-name">
                <%= link_to subsection_key.to_s.humanize,
                            send("#{subsection_key}_teacher_interface_application_form_path"),
                            aria: { describedby: "#{subsection_key}-status" } %>
              </span>

              <%= render(ApplicationFormStatusTagComponent.new(
                key: subsection_key,
                status: @application_form.section_statuses.dig(section_key, subsection_key)
              )) %>
            </li>
          <% end %>
        </ul>
      </li>
    <% end %>
  </ol>

  <%= govuk_button_to "Submit your application", submit_teacher_interface_application_form_path, disabled: !@application_form.can_submit? %>
<% end %>
