<% if f.object.present? %>
  <%= f.govuk_error_summary %>
<% end %>

<%
  section_name = @further_information_request_item
    .further_information_request
    .assessment
    .sections
    .includes(:selected_failure_reasons)
    .find_by(selected_failure_reasons: { key: @further_information_request_item.failure_reason_key })
    .key
%>
<span class="govuk-caption-l"><%= I18n.t("teacher_interface.further_information_request.show.section.#{section_name}") %></span>
<% if @further_information_request_item.document? %>
  <h1 class="govuk-heading-l">Review note from assessor</h1>
<% else %>
  <h1 class="govuk-heading-l"><%= @view_object.item_name %></h1>
<% end %>
<h2 class="govuk-heading-s"><%= @view_object.item_description %></h2>

<%= govuk_inset_text do %>
  <%= simple_format @further_information_request_item.failure_reason_assessor_feedback %>
<% end %>

<% if @further_information_request_item.text? %>
  <%= f.govuk_text_area :response, label: { size: "s" } %>
<% end %>

<% if @further_information_request_item.document? %>
  <p class="govuk-body">You can upload this document on the next screen.</p>
<% end %>

<% if @further_information_request_item.work_history_contact? %>
  <% work_history = @further_information_request_item.work_history %>
    <p class="govuk-body">Enter the contact details of a suitable referee who can verify your time spent working at <%= work_history.school_name %> from <%= work_history.start_date.to_fs(:month_and_year) %><% if work_history.end_date.present? %> to <%= work_history.end_date.to_fs(:month_and_year) %><% end %>.</p>

    <%= f.govuk_text_field :contact_name, label: { text: "Contact’s name" } %>

    <%= f.govuk_text_field :contact_job, label: { text: "Contact’s job title" } %>

    <% if @further_information_request_item.application_form.requires_private_email_for_referee? %>
      <%= f.govuk_email_field :contact_email, label: { text: "Contact’s email address" }, hint: { text: "The email address must use the school’s domain, for example, name@school.edu" } %>
    <% else %>
      <%= f.govuk_email_field :contact_email, label: { text: "Contact’s email address" } %>
    <% end %>

    <%= govuk_details(summary_text: "Choosing someone to verify this role") do %>

      <p>A senior member of staff means either a headteacher/principal, an assistant/deputy head or a school business manager.</p>

      <p>Make sure you have an up-to-date email address for the person you choose, because the reference they provide will be important to your application.</p>

      <p>We’ll ask them to confirm that you worked at the school for the period you’ve told us about.</p>

      <% if @further_information_request_item.application_form.requires_private_email_for_referee? %>
        <p>Your references need to have an email address that uses the schools domain, which is the part of an email address that shows who provides it. It comes after the @ symbol. For example, in name@school.edu the domain is school.edu.</p>
      <% end %>
    <% end %>
<% end %>

<%= render "shared/save_submit_buttons", f: %>
