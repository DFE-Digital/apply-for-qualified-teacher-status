<% content_for :page_title, "SLA Status" %>

<h1 class="govuk-heading-xl">SLA Status (Prioritisation)</h1>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-half">
    <h3 class="govuk-heading-m">Breached 10 day SLA</h3>
    <%= govuk_inset_text { @view_object.breached_sla_for_starting_prioritisation_checks_count.to_s } %>
  </div>
  <div class="govuk-grid-column-one-half">
    <h3 class="govuk-heading-m">Breached 40 day SLA</h3>
    <%= govuk_inset_text { @view_object.breached_sla_for_completing_prioritised_applications_count.to_s } %>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-half">
    <h3 class="govuk-heading-m">Nearing 10 day SLA</h3>
    <%= govuk_inset_text { @view_object.nearing_sla_for_starting_prioritisation_checks_count.to_s } %>
  </div>
  <div class="govuk-grid-column-one-half">
    <h3 class="govuk-heading-m">Nearing 40 day SLA</h3>
    <%= govuk_inset_text { @view_object.nearing_sla_for_completing_prioritised_applications_count.to_s } %>
  </div>
</div>

<%= govuk_details(summary_text: "SLA definitions") do %>
  <p class="govuk-body">10 day SLA relates to application forms that are going through prioritisation checks and expect checks to begin within 10 days of being submitted. For these applications, we consider them as nearing SLA once they are within 2 days of breaching the SLA.</p>
  <p class="govuk-body">40 day SLA relates to application forms are prioritised and expect initial assessment to be completed and moved to verification within 40 days of being submitted. For these applications, we consider them as nearing SLA once they are within 5 days of breaching the SLA.</p>
<% end %>

<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

<h2 class="govuk-heading-l">Application forms</h2>

<div class="govuk-tabs" data-module="govuk-tabs">
  <h2 class="govuk-tabs__title">
    Contents
  </h2>
  <ul class="govuk-tabs__list">
    <li class="govuk-tabs__list-item <%= 'govuk-tabs__list-item--selected' if params[:tab] != "40" %>">
      <%= link_to "10 day SLA", assessor_interface_service_level_agreements_path %>
    </li>
    <li class="govuk-tabs__list-item <%= 'govuk-tabs__list-item--selected' if params[:tab] == "40" %>">
      <%= link_to "40 day SLA", assessor_interface_service_level_agreements_path(tab: "40") %>
    </li>
  </ul>
  <div class="govuk-tabs__panel">
    <% if (records = @view_object.application_forms_records).present? %>
      <%=
        govuk_table(classes: "application-forms-sla") do |table|
          table.with_head do |head|
            head.with_row do |row|
              row.with_cell(header: true, text: "Reference")
              row.with_cell(header: true, text: "Country/Region")
              row.with_cell(header: true, text: "Working days since submission")
            end
          end

          table.with_body do |body|
            records.each do |application_form|
              body.with_row do |row|
                row.with_cell { govuk_link_to application_form.reference, [:assessor_interface, application_form] }
                row.with_cell { CountryName.from_region(application_form.region) }
                row.with_cell do
                  if params[:tab] == "40"
                    govuk_tag(text: application_form.working_days_between_submitted_and_today, colour: @view_object.sla_completed_prioritised_tag_colour(application_form) )
                  else
                    govuk_tag(text: application_form.working_days_between_submitted_and_today, colour: @view_object.sla_start_prioritisation_checks_tag_colour(application_form) )
                  end
                end
              end
            end
          end
        end
      %>
      <%= govuk_pagination(pagy: @view_object.application_forms_pagy) %>
    <% else %>
      <h2 class="govuk-heading-m"><%= t(".results.empty") %></h2>
    <% end %>
  </div>
</div>

