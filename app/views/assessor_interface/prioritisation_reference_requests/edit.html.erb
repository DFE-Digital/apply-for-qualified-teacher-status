<% content_for :page_title, title_with_error_prefix("Review reference", error: @form.errors.any?) %>
<% content_for :back_link_url, assessor_interface_application_form_assessment_prioritisation_reference_requests_path(@assessment.application_form, @assessment) %>

<% work_history = @prioritisation_reference_request.work_history %>

<%= form_with model: @form, url: [:assessor_interface, @assessment.application_form, @assessment, @prioritisation_reference_request] do |f| %>
  <%= f.govuk_error_summary %>

  <h1 class="govuk-heading-xl">View reference</h1>

  <h2 class="govuk-heading-m">
    Reference details
  </h2>

  <%= govuk_summary_list(html_attributes: { id: "prioritisation-reference-details-summary-list" }) do |summary_list|
    summary_list.with_row do |row|
      row.with_key { "Name of institution" }
      row.with_value { work_history.school_name }
    end

    summary_list.with_row do |row|
      row.with_key { "Name of reference" }
      row.with_value { work_history.contact_name }
    end

    summary_list.with_row do |row|
      row.with_key { "Job title of reference" }
      row.with_value { work_history.contact_job }
    end

    summary_list.with_row do |row|
      row.with_key { "Email address of reference" }
      row.with_value { work_history.contact_email }
    end
  end %>

  <% if (@prioritisation_reference_request.received? || @prioritisation_reference_request.expired?) && policy([:assessor_interface, @prioritisation_reference_request]).update? %>
    <% if @reference_request.received? %>
      <%= render "shared/reference_request_summary", reference_request: @reference_request, changeable: false %>
    <% elsif @reference_request.expired? %>
      <%= govuk_warning_text(text: "This reference is overdue.") %>
    <% end %>

    <%= f.govuk_radio_buttons_fieldset :passed, legend: { text: "Are you satisfied with this reference for the applicantâ€™s work history?", size: "s" } do %>
      <%= f.govuk_radio_button :passed, :true, link_errors: true %>
      <%= f.govuk_radio_button :passed, :false do %>
        <%= f.govuk_text_area :note, label: { text: "Optional reason (the applicant may see this)" } %>
      <% end %>
    <% end %>

    <%= render "shared/assessor_interface/continue_cancel_button", f: %>
  <% end %>
<% end %>
