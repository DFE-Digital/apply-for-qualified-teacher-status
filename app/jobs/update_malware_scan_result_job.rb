# frozen_string_literal: true

class UpdateMalwareScanResultJob < ApplicationJob
  discard_on ActiveRecord::RecordNotFound

  def perform(upload)
    FetchMalwareScanResult.call(upload:)

    if upload.malware_scan_pending?
      # This will ensure the job is automatically retried.
      raise StillPending
    else
      ApplicationFormSectionStatusUpdater.call(
        application_form: upload.application_form,
      )
    end
  end

  class StillPending < StandardError
  end
end
